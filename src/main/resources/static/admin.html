    <!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Administrativo - Agencia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        .nav-pills .nav-link.active { background-color: #0d6efd; }
        .nav-pills .nav-link { color: #333; font-weight: bold; font-size: 1.2rem; margin-right: 10px; border: 1px solid #ddd; }
        .form-vaga { background-color: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .campo-label { display: block; margin-bottom: 4px; font-size: 0.85rem; font-weight: 700; color: #364457; }
        .info-row { display: flex; gap: 6px; align-items: center; margin-bottom: 8px; }
        .info-row .form-control { flex: 1; }
        .info-row .btn { flex: 0 0 auto; }
        .processo-item { border: 1px solid #eee; border-radius: 6px; padding: 8px; margin-bottom: 8px; }
        .processo-item .form-control { margin-bottom: 6px; }
        .theme-toggle { min-width: 170px; }

        body.dark-mode {
            background-color: #111827 !important;
            color: #e5e7eb;
        }
        body.dark-mode .form-vaga,
        body.dark-mode .card {
            background-color: #1f2937 !important;
            color: #e5e7eb;
            border-color: #334155 !important;
            box-shadow: 0 2px 12px rgba(0,0,0,0.35);
        }
        body.dark-mode .campo-label,
        body.dark-mode h2,
        body.dark-mode h5,
        body.dark-mode .form-check-label {
            color: #e5e7eb !important;
        }
        body.dark-mode .nav-pills .nav-link {
            background-color: #0f172a;
            color: #cbd5e1;
            border-color: #334155;
        }
        body.dark-mode .nav-pills .nav-link.active {
            background-color: #2563eb;
            color: #ffffff;
        }
        body.dark-mode .table {
            color: #e5e7eb;
        }
        body.dark-mode .table thead.table-dark th {
            background-color: #0f172a;
            border-color: #1e293b;
        }
        body.dark-mode .table tbody td {
            border-color: #334155;
        }
        body.dark-mode .form-control,
        body.dark-mode .form-check-input {
            background-color: #111827;
            color: #e5e7eb;
            border-color: #475569;
        }
        body.dark-mode .form-control:focus {
            background-color: #111827;
            color: #e5e7eb;
            border-color: #60a5fa;
            box-shadow: 0 0 0 0.2rem rgba(96,165,250,0.25);
        }
        body.dark-mode .btn-outline-dark {
            color: #e5e7eb;
            border-color: #64748b;
        }
        body.dark-mode .btn-outline-dark:hover {
            background-color: #334155;
            border-color: #64748b;
        }
    </style>
</head>
<body class="bg-light">

<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold"><i class="bi bi-gear-fill"></i> Painel Administrativo</h2>
        <div class="d-flex gap-2">
            <button type="button" id="btn-theme" class="btn btn-outline-dark theme-toggle">
                <i class="bi bi-moon-stars"></i> Modo escuro
            </button>
            <a href="/tv.html" target="_blank" class="btn btn-outline-dark"><i class="bi bi-tv"></i> Ver TV</a>
        </div>
    </div>

    <ul class="nav nav-pills mb-4" id="pills-tab">
        <li class="nav-item">
            <button class="nav-link active" id="btn-vagas" onclick="mostrarAba('vagas')">GERENCIAR VAGAS</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="btn-infos" onclick="mostrarAba('infos')">GERENCIAR TELA INFORMATIVA</button>
        </li>
    </ul>

    <div id="secao-vagas">
        <div class="row">
            <div class="col-md-4">
                <div class="form-vaga">
                    <h5 class="mb-3 text-primary"><i class="bi bi-plus-circle"></i> Nova Vaga</h5>
                    <form id="formVaga">
                        <label class="campo-label" for="codigo">Código da vaga</label>
                        <input type="text" id="codigo" class="form-control mb-2">

                        <label class="campo-label" for="titulo">Titulo da vaga</label>
                        <input type="text" id="titulo" class="form-control mb-2" required>

                        <label class="campo-label" for="salario">Salario</label>
                        <input type="text" id="salario" class="form-control mb-2">

                        <label class="campo-label" for="escolaridade">Escolaridade</label>
                        <input type="text" id="escolaridade" class="form-control mb-2">

                        <label class="campo-label" for="local">Cidade / local</label>
                        <input type="text" id="local" class="form-control mb-2">

                        <label class="campo-label" for="beneficios">Benefícios</label>
                        <textarea id="beneficios" class="form-control mb-2" rows="3"></textarea>

                        <label class="campo-label" for="atribuicoes">Atribuições da vaga</label>
                        <textarea id="atribuicoes" class="form-control mb-2" rows="4"></textarea>

                        <label class="campo-label" for="validade">Validade da vaga</label>
                        <input type="date" id="validade" class="form-control mb-2">

                        <label class="campo-label" for="tipo">Tipo da vaga</label>
                        <select id="tipo" class="form-control mb-3">
                            <option value="CONVENCIONAL">Convencional</option>
                            <option value="SUPERIOR">Ensino Superior</option>
                            <option value="PCD">PCD</option>
                        </select>

                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="experiencia">
                            <label class="form-check-label">Exige Experiência?</label>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">CADASTRAR VAGA</button>
                    </form>
                </div>
            </div>

            <div class="col-md-8">
                <div class="form-vaga">
                    <h5 class="mb-3 text-secondary">Vagas Ativas no Sistema</h5>
                    <table class="table">
                        <thead class="table-dark">
                        <tr>
                            <th>Código</th>
                            <th>Título</th>
                            <th>Tipo</th>
                            <th>Validade</th>
                            <th>Ação</th>
                        </tr>
                        </thead>
                        <tbody id="tabela-vagas"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="secao-infos" style="display: none;">
        <form id="formInfos">
            <div class="row">
                <div class="col-md-4">
                    <div class="card p-3 border-primary h-100">
                        <h5 class="text-primary fw-bold">Cursos</h5>
                        <div id="cursos-list"></div>
                        <button type="button" class="btn btn-outline-primary btn-sm w-100 mt-2" onclick="addCurso()">Adicionar curso</button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card p-3 border-success h-100">
                        <h5 class="text-success fw-bold">Processo Seletivo</h5>
                        <div id="processos-list"></div>
                        <button type="button" class="btn btn-outline-success btn-sm w-100 mt-2" onclick="addProcesso()">Adicionar empresa</button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card p-3 border-danger h-100">
                        <h5 class="text-danger fw-bold">Calendario</h5>
                        <div id="cronograma-list"></div>
                        <button type="button" class="btn btn-outline-danger btn-sm w-100 mt-2" onclick="addCronograma()">Adicionar evento</button>
                    </div>
                </div>
            </div>
            <button type="button" onclick="salvarInfos()" class="btn btn-dark btn-lg w-100 mt-4">SALVAR INFORMACOES</button>
        </form>
    </div>

</div>

<script>
    const API_VAGAS = "/api/vagas";
    const API_INFOS = "/api/infos";
    const THEME_KEY = "admin_theme";

    function aplicarTema(modoEscuro) {
        document.body.classList.toggle('dark-mode', modoEscuro);
        const btn = document.getElementById('btn-theme');
        if (!btn) return;
        btn.innerHTML = modoEscuro
            ? '<i class="bi bi-sun"></i> Modo claro'
            : '<i class="bi bi-moon-stars"></i> Modo escuro';
    }

    function alternarTema() {
        const ativo = !document.body.classList.contains('dark-mode');
        localStorage.setItem(THEME_KEY, ativo ? 'dark' : 'light');
        aplicarTema(ativo);
    }

    function mostrarAba(aba) {
        document.getElementById('secao-vagas').style.display = aba === 'vagas' ? 'block' : 'none';
        document.getElementById('secao-infos').style.display = aba === 'infos' ? 'block' : 'none';
        document.getElementById('btn-vagas').classList.toggle('active', aba === 'vagas');
        document.getElementById('btn-infos').classList.toggle('active', aba === 'infos');
    }

    // --- LOGICA DAS VAGAS ---

    function formatarDataBR(valor) {
        if (!valor) return "-";
        if (/^\d{4}-\d{2}-\d{2}$/.test(valor)) {
            const [y, m, d] = valor.split("-");
            return `${d}/${m}/${y}`;
        }
        const dt = new Date(valor);
        if (!isNaN(dt)) {
            return dt.toLocaleDateString("pt-BR");
        }
        return valor;
    }

    function carregarVagas() {
        fetch(API_VAGAS)
            .then(res => res.json())
            .then(vagas => {
                const tbody = document.getElementById('tabela-vagas');
                tbody.innerHTML = '';
                vagas.forEach(v => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${v.codigo || "-"}</td>
                            <td><strong>${v.titulo}</strong></td>
                            <td>${v.categoria}</td>
                            <td>${formatarDataBR(v.validade)}</td>
                            <td><button onclick="deletarVaga(${v.id})" class="btn btn-danger btn-sm">Excluir</button></td>
                        </tr>`;
                });
            });
    }

    document.getElementById('formVaga').addEventListener('submit', function(e) {
        e.preventDefault();
        const dados = {
            codigo: document.getElementById('codigo').value,
            titulo: document.getElementById('titulo').value,
            salario: document.getElementById('salario').value,
            escolaridade: document.getElementById('escolaridade').value,
            local: document.getElementById('local').value,
            beneficios: document.getElementById('beneficios').value,
            atribuicoes: document.getElementById('atribuicoes').value,
            validade: document.getElementById('validade').value,
            categoria: document.getElementById('tipo').value,
            experiencia: document.getElementById('experiencia').checked ? "Sim" : "Nao"
        };
        fetch(API_VAGAS, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(dados)
        }).then(() => { carregarVagas(); document.getElementById('formVaga').reset(); });
    });

    function deletarVaga(id) {
        if(confirm("Deseja realmente excluir?")) {
            fetch(API_VAGAS + "/" + id, { method: 'DELETE' })
                .then(() => carregarVagas());
        }
    }

    // --- LOGICA DAS INFOS ---

    function criarInput(placeholder, className, value) {
        const input = document.createElement('input');
        input.type = 'text';
        input.className = `form-control ${className}`;
        input.placeholder = placeholder;
        input.value = value || '';
        return input;
    }

    function criarBotaoRemover() {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'btn btn-outline-danger btn-sm';
        btn.innerHTML = '<i class="bi bi-x-lg"></i>';
        btn.addEventListener('click', () => btn.parentElement.remove());
        return btn;
    }

    function addCurso(nome = '', detalhe = '') {
        const row = document.createElement('div');
        row.className = 'info-row';
        row.append(
            criarInput('Curso', 'curso-nome', nome),
            criarInput('Detalhes', 'curso-detalhe', detalhe),
            criarBotaoRemover()
        );
        document.getElementById('cursos-list').appendChild(row);
    }

    function addProcesso(empresa = '', data = '', texto = '') {
        const wrap = document.createElement('div');
        wrap.className = 'processo-item';

        const empresaInput = criarInput('Empresa', 'processo-empresa', empresa);
        const dataInput = criarInput('Data e Horario', 'processo-data', data);
        const textoArea = document.createElement('textarea');
        textoArea.className = 'form-control processo-texto';
        textoArea.rows = 4;
        textoArea.placeholder = 'Texto do processo (uma linha por item)';
        textoArea.value = texto || '';

        const btnRemover = criarBotaoRemover();
        btnRemover.className = 'btn btn-outline-danger btn-sm w-100';

        wrap.append(empresaInput, dataInput, textoArea, btnRemover);
        document.getElementById('processos-list').appendChild(wrap);
    }

    function addCronograma(data = '', evento = '') {
        const row = document.createElement('div');
        row.className = 'info-row';
        row.append(
            criarInput('Data', 'cronograma-data', data),
            criarInput('Evento', 'cronograma-evento', evento),
            criarBotaoRemover()
        );
        document.getElementById('cronograma-list').appendChild(row);
    }

    function carregarInfos() {
        fetch(API_INFOS).then(r => r.json()).then(d => {
            const cursos = Array.isArray(d.cursos) ? d.cursos : [
                { nome: d.curso1, detalhe: d.curso1Detalhe },
                { nome: d.curso2, detalhe: d.curso2Detalhe },
                { nome: d.curso3, detalhe: d.curso3Detalhe }
            ].filter(c => c.nome || c.detalhe);

            const processos = Array.isArray(d.processos) ? d.processos : [{
                empresa: d.empresaNome,
                data: d.empresaData,
                texto: Array.isArray(d.processoVagas) ? d.processoVagas : [d.vaga1, d.vaga2, d.vaga3].filter(Boolean)
            }].filter(p => p.empresa || p.data || (p.texto && p.texto.length));

            const cronograma = Array.isArray(d.cronograma) ? d.cronograma : [
                { data: d.data1, evento: d.evento1 },
                { data: d.data2, evento: d.evento2 },
                { data: d.data3, evento: d.evento3 }
            ].filter(c => c.data || c.evento);

            document.getElementById('cursos-list').innerHTML = '';
            document.getElementById('processos-list').innerHTML = '';
            document.getElementById('cronograma-list').innerHTML = '';

            if (cursos.length === 0) addCurso();
            cursos.forEach(c => addCurso(c.nome, c.detalhe));

            if (processos.length === 0) addProcesso();
            processos.forEach(p => addProcesso(p.empresa || '', p.data || '', (p.texto || []).join('\n')));

            if (cronograma.length === 0) addCronograma();
            cronograma.forEach(c => addCronograma(c.data, c.evento));
        });
    }

    function salvarInfos() {
        const d = {
            cursos: [],
            processos: [],
            cronograma: []
        };

        document.querySelectorAll('#cursos-list .info-row').forEach(row => {
            const nome = row.querySelector('.curso-nome').value.trim();
            const detalhe = row.querySelector('.curso-detalhe').value.trim();
            if (nome || detalhe) d.cursos.push({ nome, detalhe });
        });

        document.querySelectorAll('#processos-list .processo-item').forEach(item => {
            const empresa = item.querySelector('.processo-empresa').value.trim();
            const data = item.querySelector('.processo-data').value.trim();
            const texto = item.querySelector('.processo-texto').value
                .split('\n')
                .map(l => l.trim())
                .filter(Boolean);
            if (empresa || data || texto.length) {
                d.processos.push({ empresa, data, texto });
            }
        });

        if (d.processos.length > 0) {
            d.empresaNome = d.processos[0].empresa || '';
            d.empresaData = d.processos[0].data || '';
            d.processoVagas = d.processos[0].texto || [];
        } else {
            d.empresaNome = '';
            d.empresaData = '';
            d.processoVagas = [];
        }

        document.querySelectorAll('#cronograma-list .info-row').forEach(row => {
            const data = row.querySelector('.cronograma-data').value.trim();
            const evento = row.querySelector('.cronograma-evento').value.trim();
            if (data || evento) d.cronograma.push({ data, evento });
        });

        fetch(API_INFOS, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(d)
        }).then(() => alert('Informacoes da TV atualizadas!'));
    }

    // Inicio
    aplicarTema(localStorage.getItem(THEME_KEY) === 'dark');
    document.getElementById('btn-theme').addEventListener('click', alternarTema);
    carregarVagas();
    carregarInfos();
</script>
</body>
</html>
