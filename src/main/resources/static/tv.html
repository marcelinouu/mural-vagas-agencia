<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel de Vagas - Ag√™ncia</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

  <style>
    /* == GERAL == */
    body {
        margin: 0; padding: 0;
        background-color: #eef1f5; color: #333;
        font-family: 'Roboto', sans-serif;
        overflow: hidden; height: 100vh;
    }

    /* == CABE√áALHO == */
    header {
        background-color: #fff;
        padding: 0 20px;
        height: 7vh; /* Altura original que voc√™ gostou */

        display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center;

        border-bottom: 4px solid #007bff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .logo-area { justify-self: start; }

    .logo-area img {
        height: 5.5vh; /* Tamanho original da logo */
        width: auto;
        display: block;
    }

    h1 {
        margin: 0;
        font-size: 1.6em; /* Reduzi levemente pra caber os titulos longos */
        text-transform: uppercase;
        color: #2c3e50;
        letter-spacing: 1px;
        text-align: center;
        white-space: nowrap;
    }

    #relogio {
        font-size: 1.5em; color: #555; font-weight: 900; justify-self: end;
    }

    /* == GRADE 6x5 == */
    .container {
        padding: 6px;
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        grid-template-rows: repeat(5, 1fr);
        gap: 6px;
        height: 92vh;
        box-sizing: border-box;
    }

    /* == CART√ÉO == */
    .card-vaga {
        background-color: #fff; border-radius: 4px; padding: 6px 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.15); border-left: 5px solid #ccc;
        display: flex; flex-direction: column; justify-content: flex-start;
        overflow: hidden; position: relative;
    }

    .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; flex-shrink: 0; }
    .codigo-badge { background-color: #e9ecef; padding: 2px 5px; border-radius: 3px; color: #000; font-weight: 900; font-size: 0.95em; }
    .local-texto { font-size: 0.7em; color: #555; font-weight: bold; text-transform: uppercase; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 60%; }

    .card-content { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; gap: 1px; }

    .tag-exp { font-size: 0.75em; font-weight: 800; margin-bottom: 1px; display: block; }
    .com-exp { color: #0d6efd; }
    .sem-exp { color: #198754; }

    .card-vaga h2 { color: #2c3e50; margin: 0; font-size: 1em; line-height: 1.1; font-weight: 900; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

    .salario { font-size: 1.1em; color: #27ae60; font-weight: 700; margin: 2px 0 0 0; white-space: nowrap; }

    .beneficios {
        font-size: 0.8em; color: #333; font-weight: 600; line-height: 1.2;
        white-space: normal; display: -webkit-box; -webkit-line-clamp: 3;
        -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;
    }

    .descricao-extra {
        font-size: 0.75em; color: #777; margin-top: 3px; border-top: 1px solid #eee; padding-top: 2px;
        display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;
    }

    .barra-tempo { height: 4px; background-color: #007bff; width: 0%; position: absolute; bottom: 0; left: 0; }
  </style>
</head>
<body>

<header id="header-principal">
  <div class="logo-area">
    <img src="/logo.png" alt="Logo" onerror="this.style.display='none'">
  </div>
  <h1 id="titulo-categoria">CARREGANDO...</h1>
  <div id="relogio">00:00</div>
</header>

<div class="container" id="lista-vagas"></div>
<div class="barra-tempo" id="barra-progresso"></div>

<script>
  const TEMPO_POR_TELA = 20000;
  const categorias = ["CONVENCIONAL", "SUPERIOR", "PCD"];

  // MAPA DE NOMES (Backend -> O que aparece na Tela)
  const nomesExibicao = {
      "CONVENCIONAL": "PAINEL DE VAGAS CONVENCIONAIS",
      "SUPERIOR": "PAINEL DE VAGAS DE ENSINO SUPERIOR - MASTERJOB",
      "PCD": "PAINEL DE VAGAS PCD/PPD (PARA PESSOAS COM DEFICI√äNCIA)"
  };

  const cores = {
      "CONVENCIONAL": "#0056b3",
      "SUPERIOR": "#d35400",
      "PCD": "#16a085"
  };

  let indiceAtual = 0;

  async function carregarCiclo() {
      const categoriaAtual = categorias[indiceAtual];
      const cor = cores[categoriaAtual];

      // AQUI √â A M√ÅGICA: Usa o nome longo do mapa
      document.getElementById('titulo-categoria').innerText = nomesExibicao[categoriaAtual];

      document.getElementById('header-principal').style.borderBottomColor = cor;
      document.getElementById('barra-progresso').style.backgroundColor = cor;

      try {
          const response = await fetch(`/vagas/filtro?tipo=${categoriaAtual}`);
          const vagas = await response.json();
          renderizarVagas(vagas, cor);
      } catch (erro) {
          console.error("Erro:", erro);
      }

      indiceAtual++;
      if (indiceAtual >= categorias.length) indiceAtual = 0;
      animarBarra();
  }

  function renderizarVagas(listaVagas, corBorda) {
      const container = document.getElementById('lista-vagas');
      container.innerHTML = "";

      if(listaVagas.length === 0) {
          // T√≠tulo condicional tamb√©m na mensagem de "vazio"
          const tituloVazio = nomesExibicao[categorias[indiceAtual > 0 ? indiceAtual - 1 : categorias.length - 1]];

          container.innerHTML = `<h2 style="grid-column: 1/-1; text-align: center; color: #777; margin-top: 20%; font-size: 2em;">
              Nenhuma vaga dispon√≠vel em: <br>${tituloVazio}
          </h2>`;
          return;
      }

      const vagasParaMostrar = listaVagas.slice(0, 30);

      vagasParaMostrar.forEach(vaga => {
          const card = document.createElement('div');
          card.className = 'card-vaga';
          card.style.borderLeftColor = corBorda;

          const codigo = vaga.codigo || "-";
          const local = vaga.local ? "üìç" + vaga.local : "";
          const ben = vaga.beneficios ? vaga.beneficios : "";

          let tagExp = "";
          if(vaga.experiencia === "Sim") tagExp = `<span class="tag-exp com-exp">COM EXPERI√äNCIA</span>`;
          if(vaga.experiencia === "N√£o") tagExp = `<span class="tag-exp sem-exp">SEM EXPERI√äNCIA</span>`;

          let htmlDescricao = "";
          if(vaga.descricao && vaga.descricao.trim() !== "") {
              htmlDescricao = `<div class="descricao-extra">${vaga.descricao}</div>`;
          }

          card.innerHTML = `
              <div class="card-top">
                  <span class="codigo-badge">${codigo}</span>
                  <span class="local-texto">${local}</span>
              </div>
              <div class="card-content">
                  ${tagExp}
                  <h2>${vaga.titulo}</h2>
                  <div class="salario">R$ ${vaga.salario}</div>
                  <div class="beneficios">${ben}</div>
                  ${htmlDescricao}
              </div>
          `;
          container.appendChild(card);
      });
  }

  function animarBarra() {
      const barra = document.getElementById('barra-progresso');
      barra.style.transition = 'none'; barra.style.width = '0%';
      setTimeout(() => { barra.style.transition = `width ${TEMPO_POR_TELA}ms linear`; barra.style.width = '100%'; }, 50);
  }

  setInterval(() => {
      const agora = new Date();
      document.getElementById('relogio').innerText = agora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
  }, 1000);

  carregarCiclo();
  setInterval(carregarCiclo, TEMPO_POR_TELA);
</script>
</body>
</html>